!function e(n,i,a){function t(l,o){if(!i[l]){if(!n[l]){var s="function"==typeof require&&require;if(!o&&s)return s(l,!0);if(d)return d(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var r=i[l]={exports:{}};n[l][0].call(r.exports,function(e){var i=n[l][1][e];return t(i?i:e)},r,r.exports,e,n,i,a)}return i[l].exports}for(var d="function"==typeof require&&require,l=0;l<a.length;l++)t(a[l]);return t}({1:[function(e,n,i){"use strict";var a,t,d,l,o,s,u,r,c,m,v,f,p,_,g,w,b,M,y,h,P,I,E,S,F,D,O,C,k,N,B="./model",T="./vmd",V="./music",A=[{name:"Kaito",url:B+"/default/kaito.pmd",eye:[0,10,-22]},{name:"Haku",url:B+"/default/haku.pmd",eye:[0,10,-22]},{name:"MEIKO",url:B+"/default/MEIKO.pmd",eye:[0,10,-22]},{name:"Meiko (Sakine)",url:B+"/default/meiko_sakine.pmd",eye:[0,10,-22]},{name:"Miku",url:B+"/default/miku.pmd",eye:[0,10,-22]},{name:"Miku (Metal)",url:B+"/default/miku_m.pmd",eye:[0,10,-22]},{name:"Miku (v2)",url:B+"/default/miku_v2.pmd",eye:[0,10,-22]},{name:"Neru",url:B+"/default/neru.pmd",eye:[0,10,-22]},{name:"Ren",url:B+"/default/ren.pmd",eye:[0,10,-22]},{name:"Rin",url:B+"/default/rin.pmd",eye:[0,10,-22]},{name:"Rin (act2)",url:B+"/default/rin_act2.pmd",eye:[0,10,-22]},{name:"Miku (low poly)",url:B+"/low_miku/miku.pmd",eye:[0,10,-22]},{name:"Gumi (low poly)",url:B+"/low_miku/gumi.pmd",eye:[0,10,-22]},{name:"Mokou",url:B+"/mokou/mokou_A.pmd",eye:[0,10,-22]},{name:"Alice",url:B+"/alice/alice.pmd",eye:[0,10,-22],selected:!0}],G=[{name:"Toki No Kakera",url:[T+"/tokino_kakera.vmd",T+"/tokino_kakera_cam.vmd"],eye:[0,10,-22]},{name:"Sweet Magic",url:[T+"/sweetmagic-lip.vmd",T+"/sweetmagic-left.vmd"],eye:[0,10,-22],selected:!0},{name:"Wavefile (Short ver.)",url:[T+"/wavefile_v2.vmd"],eye:[0,10,-22],music:{url:V+"/wavefile_short.mp3",offset:320}}],R=[{name:"Audio OFF",value:PMDView._AUDIO_OFF},{name:"Audio ON",value:PMDView._AUDIO_ON,selected:!0}],L=[{name:"Physics OFF",value:PMDView._PHYSICS_OFF},{name:"Physics ON",value:PMDView._PHYSICS_ON,selected:!0}],x=[{name:"IK OFF",value:PMDView._IK_OFF},{name:"IK ON",value:PMDView._IK_ON,selected:!0}],U=[{name:"Morphing OFF",value:PMDView._MORPH_OFF},{name:"Morphing ON",value:PMDView._MORPH_ON,selected:!0}],H=[{name:"Stage OFF",value:PMDView._STAGE_OFF},{name:"Stage 1",value:PMDView._STAGE_1},{name:"Stage 2",value:PMDView._STAGE_2,selected:!0},{name:"Stage 3",value:PMDView._STAGE_3}],K=[{name:"Sphere mapping OFF",value:PMDView._SPHERE_MAP_OFF},{name:"Sphere mapping ON",value:PMDView._SPHERE_MAP_ON,selected:!0}],q=[{name:"Shadow mapping OFF",value:PMDView._SHADOW_MAPPING_OFF,selected:!0},{name:"Shadow mapping ON",value:PMDView._SHADOW_MAPPING_ON},{name:"Shadow mapping ONLY",value:PMDView._SHADOW_MAPPING_ONLY}],Y=[{name:"Edge OFF",value:PMDView._EDGE_OFF},{name:"Edge ON",value:PMDView._EDGE_ON,selected:!0}],W=[{name:"CPU Skinning",value:PMDView._SKINNING_CPU},{name:"GPU Skinning",value:PMDView._SKINNING_GPU},{name:"CPU+GPU Skinning",value:PMDView._SKINNING_CPU_AND_GPU,selected:!0}],X=[{name:"Frame Oriented",value:PMDView._RUN_FRAME_ORIENTED},{name:"Real Time Oriented",value:PMDView._RUN_REALTIME_ORIENTED,selected:!0}],j=[{name:"Light OFF",value:PMDView._LIGHTING_OFF},{name:"Light ON",value:PMDView._LIGHTING_ON},{name:"Light ON w/ toon",value:PMDView._LIGHTING_ON_WITH_TOON,selected:!0}],Q=[{name:"Post effect OFF",value:PMDView._EFFECT_OFF,selected:!0},{name:"Blur",value:PMDView._EFFECT_BLUR},{name:"Gaussian Blur",value:PMDView._EFFECT_GAUSSIAN},{name:"Diffusion Blur",value:PMDView._EFFECT_DIFFUSION},{name:"Division",value:PMDView._EFFECT_DIVISION},{name:"Low Resolution",value:PMDView._EFFECT_LOW_RESO},{name:"Face Mosaic",value:PMDView._EFFECT_FACE_MOSAIC}],z=0,J=60,Z=!1,$=!1,ee=null,ne=!1,ie={x:0,y:0},ae=function(e){var n=document.getElementById("statusArea");n.appendChild(document.createTextNode(e+"\n")),n.scrollTop=n.scrollHeight},te=function(){r.disabled=!1,c.disabled=!0,f.disabled=!1,p.disabled=!1,_.disabled=!1,m.disabled=!1,g.disabled=!1,w.disabled=!1,b.disabled=!1,M.disabled=!1,y.disabled=!1,h.disabled=!1,P.disabled=!1,I.disabled=!1,E.disabled=!1,S.disabled=!1,F.disabled=!1,D.disabled=!1,re(),se(),ue()},de=function(){r.disabled=!0,c.disabled=!0,f.disabled=!0,p.disabled=!0,_.disabled=!0,m.disabled=!0,g.disabled=!0,E.disabled=!0,w.disabled=!0,b.disabled=!0,M.disabled=!0,y.disabled=!0,h.disabled=!0,P.disabled=!0,I.disabled=!0,S.disabled=!0,F.disabled=!0,D.disabled=!0},le=function(){d&&d.getModelNum()>=4?r.disabled=!0:r.disabled=!1,c.disabled=!1,f.disabled=!1,p.disabled=!1,_.disabled=!1,m.disabled=!1,g.disabled=!1,w.disabled=!1,E.disabled=!1,b.disabled=!1,M.disabled=!1,y.disabled=!1,h.disabled=!1,P.disabled=!1,I.disabled=!1,S.disabled=!0,F.disabled=!1,D.disabled=!1,re(),se(),ue()},oe=function(){r.disabled=!0,c.disabled=!0,f.disabled=!1,p.disabled=!1,_.disabled=!1,m.disabled=!0,g.disabled=!1,w.disabled=!1,E.disabled=!1,b.disabled=!1,M.disabled=!1,y.disabled=!1,h.disabled=!1,P.disabled=!1,I.disabled=!1,S.disabled=!0,F.disabled=!1,D.disabled=!1,re(),se(),ue(),_.disabled=!0},se=function(){m.checked?(P.options[0].selected=!0,P.options[1].selected=!1,P.options[2].selected=!1,P.disabled=!0,_.options[0].selected=!0,_.options[1].selected=!1,_.disabled=!0):(P.disabled=!1,_.disabled=!1),Ye(d),Je(d)},ue=function(){_.options[1].selected?(P.options[0].selected=!1,P.options[1].selected=!0,P.disabled=!0):m.checked||(P.disabled=!1),Ye(d)},re=function(){var e=parseInt(p.value),n=G[e];void 0!==n.music&&null!==n.music?_.disabled=!1:(_.options[0].selected=!0,_.options[1].selected=!1,_.disabled=!0),Je(d)};window.onload=function(){r=document.getElementById("loadModelButton"),c=document.getElementById("loadMotionButton"),f=document.getElementById("modelSelect"),p=document.getElementById("motionSelect"),_=document.getElementById("audioSelect"),m=document.getElementById("videoGenerationCheckbox"),v=document.getElementById("physicsCheckbox"),g=document.getElementById("physicsSelect"),w=document.getElementById("ikSelect"),b=document.getElementById("morphSelect"),M=document.getElementById("stageSelect"),y=document.getElementById("sphereMapSelect"),h=document.getElementById("shadowMappingSelect"),I=document.getElementById("effectSelect"),P=document.getElementById("runTypeSelect"),E=document.getElementById("edgeSelect"),S=document.getElementById("skinningSelect"),F=document.getElementById("lightingSelect"),D=document.getElementById("lightColorRange"),O=document.getElementById("lightColorSpan"),u=document.getElementById("mainCanvas"),u.onblur=on,u.onmousedown=ln,u.onmouseup=on,u.onmousemove=un,u.oncontextmenu=sn,u.addEventListener("mousewheel",dn,!1),C=new Layer(u);var e=new PMDView(C);d=e,Re(),ce(f,A),ce(p,G),ce(_,R),ce(g,L),ce(w,x),ce(b,U),ce(M,H),ce(y,K),ce(h,q),ce(P,X),ce(I,Q),ce(E,Y),ce(S,W),ce(F,j),Le(e),xe(e),Ue(e),He(e),Ke(e),Ye(e),We(e),Xe(e),je(e),Qe(e),ze(e),Je(e),ae("select model and click load model button."),te()};var ce=function(e,n){for(var i=0;i<n.length;i++){var a=document.createElement("option");a.selected=n[i].selected?!0:!1,a.value=i,a.innerText=n[i].name,e.appendChild(a)}},me=function(){de();var e=parseInt(f.value);k=A[e];var n=k.url,i=new XMLHttpRequest;i.responseType="arraybuffer",i.onload=function(){ve(i.response)},i.onerror=function(e){var n="";for(var i in e)n+=i+"="+e[i]+"\n";ae(n),te()},i.open("GET",n,!0),i.send(null),ae("loading PMD file...")},ve=function(e){ae("parsing PMD file..."),requestAnimationFrame(function(){fe(e)})},fe=function(e){var n=new PMDFileParser(e);if(a=n,!n.valid())return ae("this file seems not a PMD file..."),void te();var i=n.parse();t=i,i.setup(),pe(i)},pe=function(e){var n=k.url,i=n.substring(0,n.lastIndexOf("/"));e.loadImages(i,_e),ae("loading images...")},_e=function(e){var n=d;ae("PMD is ready."),ae("select motion and click load motion button."),n.getModelNum()<4&&ae("Or select model and click load model button."),le(),Z=!0;var i=new PMDModelView(C,e,n);i.setup(),n.addModelView(i),ge(n.modelViews),1===n.getModelNum()&&(n.setEye(k.eye),an(n))},ge=function(e){switch(e.length){case 1:e[0].setBasePosition(0,0,0);break;case 2:e[0].setBasePosition(-10,0,0),e[1].setBasePosition(10,0,0);break;case 3:e[0].setBasePosition(0,0,0),e[1].setBasePosition(10,0,10),e[2].setBasePosition(-10,0,10);break;case 4:e[0].setBasePosition(5,0,0),e[1].setBasePosition(-5,0,0),e[2].setBasePosition(15,0,10),e[3].setBasePosition(-15,0,10);break;case 5:e[0].setBasePosition(0,0,0),e[1].setBasePosition(10,0,10),e[2].setBasePosition(-10,0,10),e[3].setBasePosition(20,0,20),e[4].setBasePosition(-20,0,20)}},we=function(){de();var e=parseInt(p.value);N=G[e];var n=N.url;be(n,0,[])},be=function(e,n,i){var a=e[n],t=new XMLHttpRequest;t.responseType="arraybuffer",t.onload=function(){i.push(t.response),n+1>=e.length?Me(i):be(e,n+1,i)},t.onerror=function(e){var n="";for(var i in e)n+=i+"="+e[i]+"\n";ae(n),le()},t.open("GET",a,!0),t.send(null),ae("loading VMD file "+(n+1)+" ...")},Me=function(e){ae("parsing VMD files..."),requestAnimationFrame(function(){ye(e)})},ye=function(e){var n,i=[],a=[];for(n=0;n<e.length;n++){if(a[n]=new VMDFileParser(e[n]),!a[n].valid())return ae("file "+(n+1)+" seems not a VMD file..."),void le();i[n]=a[n].parse()}var t=i[0];a[0];for(l=a[0],o=i[0],n=1;n<e.length;n++)t.merge(i[n]);d.setVMD(t),d.setEye(N.eye),$=!0,N.music?he():Pe()},he=function(){de();var e=N.music.url,n=new Audio(e);n.addEventListener("canplaythrough",function(){Pe()}),d.setAudio(n,N.music.offset),ae("loading Audio files...")},Pe=function(){if(ae("ready."),ae("starts dance."),d.startDance(),m.checked){ee=new Whammy.Video(60);var e=document.getElementById("videoSpan"),n=document.createElement("button");n.innerText="output video",n.onclick=function(){$e()},e.appendChild(n)}oe()},Ie=function(){Le(d)},Ee=function(){xe(d)},Se=function(){Ue(d)},Fe=function(){He(d)},De=function(){Ke(d)},Oe=function(){qe(d)},Ce=function(){Ye(d)},ke=function(){We(d)},Ne=function(){Xe(d)},Be=function(){je(d)},Te=function(){Qe(d)},Ve=function(){Re(),ze(d)},Ae=function(){ue(),Je(d)},Ge=function(){re(),Ae()},Re=function(){O.innerText=D.value},Le=function(e){var n=parseInt(g.value);e.setPhysicsType(L[n].value)},xe=function(e){var n=parseInt(w.value);e.setIKType(x[n].value)},Ue=function(e){var n=parseInt(b.value);e.setMorphType(U[n].value)},He=function(e){var n=parseInt(M.value);e.setStageType(H[n].value)},Ke=function(e){var n=parseInt(y.value);e.setSphereMapType(K[n].value)},qe=function(e){var n=parseInt(h.value);e.setShadowMappingType(q[n].value)},Ye=function(e){var n=parseInt(P.value);e.setRunType(X[n].value)},We=function(e){var n=parseInt(I.value);e.setEffectFlag(Q[n].value)},Xe=function(e){var n=parseInt(E.value);e.setEdgeType(Y[n].value)},je=function(e){var n=parseInt(S.value);e.setSkinningType(W[n].value)},Qe=function(e){var n=parseInt(F.value);e.setLightingType(j[n].value)},ze=function(e){var n=parseFloat(D.value);e.setLightColor(n)},Je=function(e){var n=parseInt(_.value);e.setAudioType(R[n].value)},Ze=function(){se()},$e=function(){if(null!==ee){var e=document.getElementById("videoSpan");for(e.firstChild.disabled=!0;e.firstChild.nextSibling;)e.removeChild(e.firstChild.nextSibling);ae("compiling video file..."),requestAnimationFrame(function(){en()})}},en=function(){var e=ee.compile();ae("creating object URL..."),requestAnimationFrame(function(){nn(e)})},nn=function(e){var n=URL.createObjectURL(e),i=document.getElementById("videoSpan");i.firstChild.disabled=!1;var a=document.createElement("a");a.innerText="video",a.href=n,a.target="_blank",a.style.marginLeft="10px",i.appendChild(a),ae("video was generated.")},an=function(e){e.update(),e.draw(),null!==ee&&ee.add(e.layer.canvas),requestAnimationFrame(function(){an(e)}),tn(),z++},tn=function(){if(z%J===0){var e=Date.now();if(void 0!==s){var n=parseInt(1e3*J/(e-s));document.getElementById("fpsSpan").innerText=n+"fps"}s=e}},dn=function(e){if(Z){var n=(e.detail||e.wheelDelta)>0?1:-1;d.moveCameraForward(n),e.preventDefault()}},ln=function(e){Z&&(ne=!0,ie.x=e.clientX,ie.y=e.clientY)},on=function(e){Z&&(ne=!1)},sn=function(e){Z&&(d.resetCameraMove(),e.preventDefault())},un=function(e){if(Z&&ne){var n=(ie.x-e.clientX)/u.width,i=(ie.y-e.clientY)/u.height;e.shiftKey?d.moveCameraTranslation(n,i):d.moveCameraQuaternionByXY(n,i),ie.x=e.clientX,ie.y=e.clientY}};window.__loadModelButtonClicked=me,window.__loadMotionButtonClicked=we,window.__motionSelectChanged=Ge,window.__audioSelectChanged=Ae,window.__videoGenerationCheckboxChanged=Ze,window.__physicsSelectChanged=Ie,window.__loadMotionButtonClicked=we,window.__ikSelectChanged=Ee,window.__morphSelectChanged=Se,window.__stageSelectChanged=Fe,window.__sphereMapSelectChanged=De,window.__shadowMappingSelectChanged=Oe,window.__edgeSelectChanged=Ne,window.__skinningSelectChanged=Be,window.__runTypeSelectChanged=Ce,window.__effectSelectChanged=ke,window.__lightingSelectChanged=Te,window.__lightColorRangeChanged=Ve},{}]},{},[1]);